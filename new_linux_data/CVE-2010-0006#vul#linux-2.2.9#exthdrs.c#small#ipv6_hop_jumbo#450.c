static int ipv6_hop_jumbo(struct sk_buff *skb, u8 *ptr)
{
	u32 pkt_len;

	if (ptr[1] != 4 || ((ptr-skb->nh.raw)&3) != 2) {
		if (net_ratelimit())
			printk(KERN_DEBUG "ipv6_hop_jumbo: wrong jumbo opt length/alignment %d\n", ptr[1]);
		goto drop;
	}

	pkt_len = ntohl(*(u32*)(ptr+2));
	if (pkt_len < 0x10000) {
		icmpv6_param_prob(skb, ICMPV6_HDR_FIELD, ptr+2);
		return 0;
	}
	if (skb->nh.ipv6h->payload_len) {
		icmpv6_param_prob(skb, ICMPV6_HDR_FIELD, ptr);
		return 0;
	}

	if (pkt_len > skb->len - sizeof(struct ipv6hdr)) {
		ipv6_statistics.Ip6InTruncatedPkts++;
		goto drop;
	}
	skb_trim(skb, pkt_len + sizeof(struct ipv6hdr));
	return 1;

drop:
	kfree_skb(skb);
	return 0;
}
